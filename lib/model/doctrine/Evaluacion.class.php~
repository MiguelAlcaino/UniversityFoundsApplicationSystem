<?php

/**
 * Evaluacion
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 * 
 * @package    postulacion_interna
 * @subpackage model
 * @author     Miguel Alcaino
 * @version    SVN: $Id: Builder.php 7490 2010-03-29 19:53:27Z jwage $
 */
class Evaluacion extends BaseEvaluacion
{
  
  public function getAjusteRecursoByRecursoId($recurso_id){
  
    return Doctrine_Core::getTable('AjusteRecurso')->findOneByRecursoIdAndEvaluacionId($recurso_id, $this->getId());
  }
  
  public function getNotaFormulacionByAcronimoTipoArchivo($acronimo){
    $acronimo_original = $acronimo;
    if($acronimo == 'definicion_problema_y_solucion_0' || $acronimo == 'definicion_problema_y_solucion_1'){
      $acronimo = 'definicion_problema_y_solucion';
    }
    $tipo_archivo = Doctrine_Core::getTable('TipoArchivo')->findOneByAcronimo($acronimo);
    if(!$tipo_archivo){
      $tipo_archivo = Doctrine_Core::getTable('TipoArchivo')->findOneByAcronimo('marco_teorico');
    }
    $concurso_tipo_archivo = Doctrine_Core::getTable('ConcursoTipoArchivo')->findOneByConcursoIdAndTipoArchivoId($this->getPersonaConcurso()->getConcurso()->getId(), $tipo_archivo->getId());
    
    if($acronimo_original == 'definicion_problema_y_solucion_0'){
      $porcentaje_formulacion = Doctrine_Core::getTable('PorcentajeEvaluacion')->findOneByConcursoTipoArchivoIdAndNumero($concurso_tipo_archivo->getId(), 1);
    }else{
      if($acronimo_original == 'definicion_problema_y_solucion_1'){
         $porcentaje_formulacion = Doctrine_Core::getTable('PorcentajeEvaluacion')->findOneByConcursoTipoArchivoIdAndNumero($concurso_tipo_archivo->getId(), 2);
      }else{
        if($this->getPersonaConcurso()->getConcurso()->getAcronimo() == 'di_sello_valorico' || $this->getPersonaConcurso()->getConcurso()->getAcronimo() == 'di_artes'){
          $porcentaje_formulacion = Doctrine_Core::getTable('PorcentajeEvaluacion')->findOneByConcursoTipoArchivoIdAndNombreNota($concurso_tipo_archivo->getId(), $acronimo)
        }else{
          $porcentaje_formulacion = Doctrine_Core::getTable('PorcentajeEvaluacion')->findOneByConcursoTipoArchivoIdAndNumero($concurso_tipo_archivo->getId(), 1);
        }
      }
    }
    
    return Doctrine_Core::getTable('NotaFormulacion')->findOneByPorcentajeEvaluacionIdAndEvaluacionId($porcentaje_formulacion->getId(), $this->getId());
    
    //$porcentaje_evaluacion = Doctrine_Core::getTable('PorcentajeEvaluacion')->findOneByConcursoTipoArchivoIdAnd
  }  
  
  public function getNotaProductividadByTipoProductividad($tipo_productividad){
    return Doctrine_Core::getTable('NotaProductividad')->findOneByEvaluacionIdAndPorcentajeProductividadConcursoId($this->getId(), Doctrine_Core::getTable('PorcentajeProductividadConcurso')->findOneByConcursoIdAndTipoProductividad($this->getPersonaConcurso()->getConcurso()->getId(), $tipo_productividad)->getId());
  }
  public function __toString(){
    return $this->getPersonaConcurso().' - '.$this->getPersonaConcurso()->getPersona();
  }
  
  public function getNombreEvaluacion(){
    return $this->getPersonaConcurso().' - '.$this->getPersonaConcurso()->getPersona().' - '.$this->getPersonaConcurso()->getPersona()->getTipoProfesor().' - '.$this->getPersonaConcurso()->getPersona()->getUnidadAcademica();
  }
  
  public function getArchivoPostulacionByAcronimo($acronimo){
    
    if($acronimo == 'definicion_problema_y_solucion_0' || $acronimo == 'definicion_problema_y_solucion_1'){
      $acronimo = 'definicion_problema_y_solucion';
    }
    $tipo_archivo = Doctrine_Core::getTable('TipoArchivo')->findOneByAcronimo($acronimo);
    
    if($tipo_archivo){
      //$archivo_postulacion = Doctrine_Core::getTable('ArchivoPostulacion')->findOneByIdPersonaConcursoAndIdTipoArchivo($this->getPersonaConcursoId(), $tipo_archivo->getId());
    
      return Doctrine_Core::getTable('ArchivoPostulacion')->findOneByIdPersonaConcursoAndIdTipoArchivo($this->getPersonaConcursoId(), $tipo_archivo->getId());
    }else{
      $tipo_archivo = Doctrine_Core::getTable('TipoArchivo')->findOneByAcronimo('marco_teorico');
      return Doctrine_Core::getTable('ArchivoPostulacion')->findOneByIdPersonaConcursoAndIdTipoArchivo($this->getPersonaConcursoId(), $tipo_archivo->getId());
    }
    
    
  }
  
  public function getRecursoById($id){
    return Doctrine_Core::getTable('Recurso')->find($id);
  }
  
  public function getDetalleRecursoById($id){
    return Doctrine_Core::getTable('DetalleRecurso')->find($id);
  }
  /*
  public function getDetalleRecursoByRecursoIdAndPeriodo($recurso_id, $periodo){
    
  }*/
  
  public function getNotaProductividadByPorcentajeProductividadConcurso(PorcentajeProductividadConcurso $procentaje_productividad_concurso){
    return Doctrine_Core::getTable('NotaProductividad')->findOneByEvaluacionIdAndPorcentajeProductividadConcursoId($this->getId(), $procentaje_productividad_concurso->getId());
  }
  
}
